# 常见问题

## 回测是否考虑滑点与手续费？

**除 ETF 轮动回测外**，本系统中**量化回测**（普通回测、LLM 信号回测、AI Agent 量化中的回测）、**因子挖掘回测**、**选股池组合回测**均**未考虑滑点与手续费**。回测得到的收益、夏普、回撤等为理论值，实盘或高频调仓时交易成本会显著影响实际表现，请以回测结果仅作参考，实盘前需自行评估滑点与手续费影响。ETF 轮动模块的回测与模拟盘支持配置滑点与手续费，详见 [ETF轮动策略交易逻辑](module/detail/etf_rotation_trading_logic.md)。

---

## 回测/数据拉取报「网络连接错误」（akshare）

若回测或获取股票数据时出现「网络连接错误」「重试 3 次后仍失败」，多为 akshare 访问东方财富等数据源失败。可先做连接检查：

```bash
# 在项目根目录、已激活 venv 下执行
python -m tools.check_akshare
```

脚本会检测：环境变量（代理）、基础网络、akshare 版本、以及一次真实的 A 股日线请求（与回测同接口），并给出失败时的建议。

### 常见原因与处理

| 原因 | 建议 |
|------|------|
| 东方财富限流/封禁 | 稍后重试；或在浏览器打开 [东方财富](https://www.eastmoney.com/) 登录后再运行 |
| 本机使用代理 | 在测试/回测时临时取消代理：`set HTTP_PROXY=`、`set HTTPS_PROXY=`（Windows）或 `unset HTTP_PROXY HTTPS_PROXY`（Linux/Mac） |
| akshare 过旧 | `pip install akshare --upgrade` |
| 网络不稳定 | 换网络（如手机热点）或稍后再试 |

---

## Python 环境

支持 **Python 3.8+**，推荐使用 **Python 3.10**。示例：

```bash
python -m uvicorn api_server:app --host 127.0.0.1 --port 8000 --reload
```

---

## API 密钥

- 在项目根目录的 `.env` 文件中配置 `DEEPSEEK_API_KEY`。
- Docker 部署时请确保运行目录下存在 `.env` 且已填写密钥，否则 LLM 相关功能无法使用。

---

## CNINFO 参数

报告类型必须使用**英文**：

- annual（年报）
- semi-annual（半年报）
- quarterly（季报）

---

## 知识库

当前知识库在内存中，服务重启后会清空。如需持久化，可使用 `FAISS.save_local()` 等方式落盘（具体见知识库相关文档）。

---

## Docker 部署

- 数据目录通过卷挂载到**项目根目录**下的 `data/`、`db/`、`pools/`，即运行 `docker-compose` 的目录；后端读写的是宿主机上的这些文件夹。
- 如需重置容器与卷：`docker-compose down -v`。
- 确保 Docker Desktop（Windows/Mac）已启动。

---

## 端口占用

- 后端默认：8000；前端开发：5173，Docker 生产：80。
- 若端口被占用，可修改 `docker-compose.yml` 中的端口映射，或调整 uvicorn / Vite 的启动参数。
